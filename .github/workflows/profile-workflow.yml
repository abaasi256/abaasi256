name: Profile Portfolio CI/CD

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    # Run daily at 00:00 UTC to keep the profile active
    - cron: '0 0 * * *'

jobs:
  validate-profile:
    runs-on: ubuntu-latest
    name: Validate Portfolio Content
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      
    - name: Check README exists
      run: |
        echo "üîç Checking README.md exists..."
        if [ -f "README.md" ]; then
          echo "‚úÖ README.md found"
          echo "üìÑ README size: $(wc -c < README.md) bytes"
        else
          echo "‚ùå README.md not found"
          exit 1
        fi
        
    - name: Validate Portfolio Structure
      run: |
        echo "üèóÔ∏è Validating portfolio structure..."
        
        # Check for key sections
        if grep -q "Cloud/DevOps Engineer" README.md; then
          echo "‚úÖ Professional title found"
        fi
        
        if grep -q "7+ years" README.md; then
          echo "‚úÖ Experience level mentioned"
        fi
        
        if grep -q "Featured Projects" README.md; then
          echo "‚úÖ Projects section found"
        fi
        
        echo "üéØ Portfolio structure validation complete"
        
    - name: Check GitHub Stats Integration
      run: |
        echo "üìä Verifying GitHub stats integration..."
        # Simple check without external API calls
        if grep -q "github-readme-stats" README.md; then
          echo "‚úÖ GitHub stats integration found"
        fi
        
        if grep -q "komarev.com/ghpvc" README.md; then
          echo "‚úÖ Profile visitor counter found"
        fi
        
        echo "üìà Stats integration check complete"
        
    - name: Portfolio Health Check
      run: |
        echo "üè• Running basic portfolio health check..."
        
        # Count sections
        SECTIONS=$(grep -c "^##" README.md)
        echo "üìã Portfolio sections: $SECTIONS"
        
        # Check for contact information
        if grep -q "linkedin.com" README.md; then
          echo "‚úÖ LinkedIn profile linked"
        fi
        
        if grep -q "github.com" README.md; then
          echo "‚úÖ GitHub profile linked"
        fi
        
        echo "üéâ Portfolio health check completed!"

  update-profile-metrics:
    runs-on: ubuntu-latest
    name: Update Profile Metrics
    needs: validate-profile
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Profile Status Update
      run: |
        echo "üìà Profile metrics update simulation..."
        echo "üîÑ Last updated: $(date -u)"
        echo "‚úÖ Profile is active and maintained"
        echo "üöÄ Ready for professional viewing"
        
    - name: Success Notification
      run: |
        echo "üéØ Profile Portfolio CI/CD completed successfully!"
        echo "‚ú® All systems operational"
        echo "üìÖ Next automated check: $(date -d '+1 day' -u)"

  deploy-status:
    runs-on: ubuntu-latest
    name: Deployment Status
    needs: [validate-profile, update-profile-metrics]
    if: always()
    
    steps:
    - name: Final Status Report
      run: |
        echo "üèÜ CI/CD Pipeline Status Report"
        echo "================================"
        
        if [ "${{ needs.validate-profile.result }}" == "success" ]; then
          echo "‚úÖ Portfolio Validation: PASSED"
        else
          echo "‚ùå Portfolio Validation: FAILED"
        fi
        
        if [ "${{ needs.update-profile-metrics.result }}" == "success" ]; then
          echo "‚úÖ Metrics Update: COMPLETED"
        else
          echo "‚ö†Ô∏è  Metrics Update: SKIPPED"
        fi
        
        echo "üåü Portfolio Status: ACTIVE"
        echo "üìä CI/CD Badge: PASSING"
        echo "üöÄ Ready for professional use!"